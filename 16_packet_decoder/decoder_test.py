from decoder import *


def test_hex2bin_example():
    bin = hex2bin('EE00D40C823060')

    assert bin == '11101110000000001101010000001100100000100011000001100000'


def test_hex2bin_input():
    bin = hex2bin('E0525D9802FA00B80021B13E2D4260004321DC648D729DD67B2412009966D76C0159ED274F6921402E9FD4AC1B0F652CD339D7B82240083C9A54E819802B369DC0082CF90CF9280081727DAF41E6A5C1B9B8E41A4F31A4EF67E2009834015986F9ABE41E7D6080213931CB004270DE5DD4C010E00D50401B8A708E3F80021F0BE0A43D9E460007E62ACEE7F9FB4491BC2260090A573A876B1BC4D679BA7A642401434937C911CD984910490CCFC27CC7EE686009CFC57EC0149CEFE4D135A0C200C0F401298BCF265377F79C279F540279ACCE5A820CB044B62299291C0198025401AA00021D1822BC5C100763A4698FB350E6184C00A9820200FAF00244998F67D59998F67D5A93ECB0D6E0164D709A47F5AEB6612D1B1AC788846008780252555097F51F263A1CA00C4D0946B92669EE47315060081206C96208B0B2610E7B389737F3E2006D66C1A1D4ABEC3E1003A3B0805D337C2F4FA5CD83CE7DA67A304E9BEEF32DCEF08A400020B1967FC2660084BC77BAC3F847B004E6CA26CA140095003900BAA3002140087003D40080022E8C00870039400E1002D400F10038C00D100218038F400B6100229500226699FEB9F9B098021A00800021507627C321006E24C5784B160C014A0054A64E64BB5459DE821803324093AEB3254600B4BF75C50D0046562F72B1793004667B6E78EFC0139FD534733409232D7742E402850803F1FA3143D00042226C4A8B800084C528FD1527E98D5EB45C6003FE7F7FCBA000A1E600FC5A8311F08010983F0BA0890021F1B61CC4620140EC010100762DC4C8720008641E89F0866259AF460C015D00564F71ED2935993A539C0F9AA6B0786008D80233514594F43CDD31F585005A25C3430047401194EA649E87E0CA801D320D2971C95CAA380393AF131F94F9E0499A775460')

    assert '1' in bin
    assert '0' in bin


def test_packet_version_and_type():
    packet = Packet.parse('110100101111111000101000')

    assert packet.version == 6
    assert type(packet) == Literal


def test_literal_value():
    packet = Packet.parse('110100101111111000101000')

    assert list(packet.groups()) == ['0111', '1110', '0101']
    assert packet.calculate() == 2021


def test_sub_packets():
    packet = Packet.parse(
        '00111000000000000110111101000101001010010001001000000000')

    assert packet.sub_packets() == [Packet.parse(
        '11010001010'), Packet.parse('0101001000100100')]

    assert type(packet) == Lower


def test_literal_package_length():
    # padded with 3 zeros on the right
    literal = Packet.parse('110100101111111000101000')

    assert len(literal) == 21


def test_operator_package_length():

    operator = Packet.parse(
        '00111000000000000110111101000101001010010001001000000000')

    assert operator.size_header_length() == 15
    assert len(operator) == 49


def test_sum_of_versions_8A004A801A8002F478():
    packet = Packet.parse(hex2bin('8A004A801A8002F478'))

    assert sum_of_versions(packet) == 16


def test_sum_of_versions_C0015000016115A2E0802F182340():
    packet = Packet.parse(hex2bin('C0015000016115A2E0802F182340'))

    assert sum_of_versions(packet) == 23


def test_sum_of_versions_A0016C880162017C3686B18A3D4780():
    packet = Packet.parse(hex2bin('A0016C880162017C3686B18A3D4780'))

    assert sum_of_versions(packet) == 31
